/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var global = window;
var middleware = __webpack_require__(1);
var _Router = __webpack_require__(2);
var $controller = __webpack_require__(3);

global.$khan = function () {
	function _class() {
		_classCallCheck(this, _class);

		var self = this;
		this.$db_application = new Map();
		this.middleware = new middleware();
		return this;
	}

	_createClass(_class, [{
		key: 'set',
		value: function set(name, fn) {
			this.$db_application.set(name, fn);
		}
	}, {
		key: 'get',
		value: function get(name) {
			this.$db_application.get(name);
		}
	}, {
		key: 'use',
		value: function use(fn) {
			if (fn.name && fn.name === "Router") {
				this.routeAwait = fn;
			}
			if (!fn.name && fn.name !== "Router") {
				this.middleware.use(fn);
			}
		}
	}, {
		key: 'Router',
		value: function Router() {
			return _Router;
		}
	}, {
		key: 'listen',
		value: function listen() {
			var self = this;
			this.middleware.go(function () {
				delete this['go'];
				if (self.routeAwait) {
					var run = self.routeAwait.dispatch();

					var _run = _slicedToArray(run, 4),
					    callback = _run[0],
					    pathh = _run[1],
					    params = _run[2],
					    active = _run[3];

					params = params || [];
					callback.bind(Object.assign({}, this, {
						"pathname": pathh,
						"uri": active
					})).apply(undefined, _toConsumableArray(params));
				}
			});
		}
	}, {
		key: '$controller',
		get: function get() {
			return $controller;
		}
	}]);

	return _class;
}();

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Middleware = function () {
  function Middleware() {
    _classCallCheck(this, Middleware);
  }

  _createClass(Middleware, [{
    key: "use",
    value: function use(fn) {
      var _this = this;

      this.go = function (stack) {
        return function (next) {
          return stack(fn.bind(_this, next.bind(_this)));
        };
      }(this.go);
    }
  }, {
    key: "go",
    value: function go(next) {
      return next();
    }
  }]);

  return Middleware;
}();

module.exports = Middleware;

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var Router = {};

Router.routes = [];

Router.any = function (route, fn) {
	if (route.includes('{') && route.includes('}')) {
		route = route.replace(/\{(.*?)}/g, '(.*)');
	} else {
		route = route + '?';
	}
	Router.routes.push({ path: route, callback: fn });
};

Router.name = "Router";

Router.not_found = {
	"path": 'not_found',
	"callback": function callback() {
		document.body.innerHTML += '<h1>Router: "' + this.uri + '" not found!!</h1>';
	}
};

Router.path_active = location.hash ? location.hash.slice(1) : location.pathname;

Router.dispatch = function () {
	var splited = function splited(str) {
		return str.split('/').length;
	};
	var params = [],
	    args = [];
	var router = Router.routes.filter(function (route) {
		var pattern = new RegExp('^' + route.path);
		args = Router.path_active.match(pattern);
		if (Array.isArray(args) && args !== null) {
			args = args.slice(1);
		}
		return pattern.test(Router.path_active) && splited(route.path) == splited(Router.path_active);
	});
	router = router.length > 0 ? router[0] : Router.not_found;
	return [router.callback, router.path, args, Router.path_active];
};

module.exports = Router;

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

window.$broadcast = function () {
    var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var ctrl = arguments[1];

    return function () {
        var update = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};

        return new Proxy(data, {
            get: function get(target, key) {
                return key in target ? target[key] : null;
            },
            set: function set(target, key, value) {
                if (!target["$_updates"]) target["$_updates"] = true;
                ctrl[key] = value;
                target[key] = value;
                update(target, key, value);
            }
        });
    };
};

window.khanApp = {};

khanApp.db = {};
khanApp.last_render_buffer = {};

khanApp.create = function () {
    return this;
};

khanApp.$controller = function ($view, $event) {
    if (!window['khan_controller']) window['khan_controller'] = {};
    var view = document.querySelector("[khan-controller=\"" + $view + "\"]");
    view.setAttribute('visibility', 'hidden');
    if (view) {
        window['khan_controller'][$view] = {};
        var model = window['khan_controller'][$view];
        var $ctrl = "window.khan_controller." + $view;
        //$event.bind(proxy)(proxy);
        $event.bind(new (function () {
            function _class() {
                _classCallCheck(this, _class);
            }

            _createClass(_class, [{
                key: "render",
                value: function render() {
                    model = Object.assign({ render: function render() {} }, model, this);
                    window['khan_controller'][$view] = model;
                    khanApp.render("[khan-controller=\"" + $view + "\"]", model, $ctrl);
                    var proxy = $broadcast(model, window['khan_controller'][$view])(khanApp.updateView("[khan-controller=\"" + $view + "\"]", $ctrl));
                    $event.bind(proxy)(proxy);
                }
            }]);

            return _class;
        }())())();
    }
};

khanApp.parse_template = function (code, data, controller) {

    var receive = Object.keys(data).filter(function (k) {
        return k !== "render";
    }).map(function (k) {
        return "\\$" + k;
    }).join('|');
    receive = new RegExp(receive, 'gim');

    code = code.replace(receive, function (match) {
        var m = match.replace('$', '');
        if (data[m]) {
            var $d = controller + "." + m;
            if (typeof data[m] === "function") {
                if (!data.computed) data.computed = {};
                data["computed"][m] = data[m];
                $d = controller + ".computed." + m;
            }
            return $d;
        }
    }).replace(/\{\{/gim, '${').replace(/\}\}/gim, '}');

    var interpolates = function interpolates(code) {
        return code.replace(new RegExp('&gt;', 'gim'), '>').replace(new RegExp('&lt;', 'gim'), '<').replace(new RegExp('\\<\\(', 'gim'), "'").replace(new RegExp('\\)\\>', 'gim'), "'").replace(new RegExp('\\<\\=\\(', 'gim'), "+ '").replace(new RegExp('\\)\\=\\>', 'gim'), "' +");
    };

    code = interpolates(code);

    return new Function('return `' + code + '`;');
};

khanApp.data = function (view) {
    var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

    if (value === null && key !== null) return view.dataset[key];
    if (value !== null && key !== null) view.dataset[key] = value;
};

khanApp.render = function (view, data, controller) {
    var code = 'false';
    view = document.querySelector(view);
    if (!khanApp.data(view, 'render')) {
        khanApp.data(view, 'render', Math.floor(Math.random() * 10000));
    }
    if (!khanApp.render_buffer) khanApp.render_buffer = {};
    if (!khanApp.render_buffer[view.dataset['render']]) {
        khanApp.render_buffer[view.dataset['render']] = view.innerHTML;
        code = khanApp.parse_template(view.innerHTML, data, controller);
    } else {
        code = khanApp.parse_template(khanApp.render_buffer[view.dataset['render']], data, controller);
    }

    try {
        view.innerHTML = code();
    } catch (e) {}
};

khanApp.updateView = function (view, controller) {
    // console.log('Update!!');
    return function (data, key, value) {
        khanApp.render(view, data, controller);
    };
};

module.exports = khanApp.create().$controller;

/***/ })
/******/ ]);
//# sourceMappingURL=khan.min.js.map